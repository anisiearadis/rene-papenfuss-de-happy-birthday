<script>
    import {marked} from "marked";
    import Cake from "./Cake.svelte";
    import HintCard from "./HintCard.svelte";
    import CodeForm from "./CodeForm.svelte";
    import Image from "./Image.svelte";

    const pages = [
        // COVER
        {
            isCover: true,
            isTurnedOver: false,
            isClickable: true,
            parts: [
                {
                    type: 'markdown',
                    content: marked.parse(`
# Alles Gute zum Geburtstag, Kristin!
                    `),
                },
                {
                    type: 'cake',
                },
            ],
        },
        // GLÃœCKWUNSCH
        {
            isCover: false,
            isTurnedOver: false,
            isClickable: true,
            parts: [
                {
                    type: 'markdown',
                    content: marked.parse(`
### GlÃ¼ckwÃ¼nsche

Hallo mein Schatzi,

ich wÃ¼nsche dir alles Liebe und Gute zum Geburtstag. Ganz viel

- GlÃ¼ck ğŸ€
- Erfolg ğŸ‘
- Kraft ğŸ’ª und
- Gesundheit ğŸ’Š

im neuen Lebensjahr!

Da ja alles anders gekommen ist als ich geplant hatte und ich teilweise zu ungeduldig war, musste ich etwas umbauen. ğŸ˜…

Auf den nÃ¤chsten Seiten erzÃ¤hle ich nun einfach etwas darÃ¼ber, was ich geplant hatte und wie es weiter geht. Wenn
du Lust hast mehr davon zu erfahren, dann blÃ¤tter auf die nÃ¤chste Seite. ğŸ˜˜
                    `),
                },
            ],
        },
        // Planung 1
        {
            isCover: false,
            isTurnedOver: false,
            isClickable: true,
            parts: [
                {
                    type: 'markdown',
                    content: marked.parse(`
Begonnen hat eigentlich alles damit, dass ich dich an deinem Geburtstag Ã¼berraschen wollte, indem ich einfach bei dir
vor der TÃ¼r stehe. Dann hatte ich gedacht, dass das zwar cool wÃ¤re, aber da mÃ¼sse noch etwas SpaÃŸ mit eingebaut werden.

Also habe ich mit dieser Seite angefangen. Ich wollte eine kleine Schnitzeljagd in deiner Wohnung veranstalten. Da
hÃ¤tte ich in jedem Raum eine Karte versteckt mit Nummern und Hinweisen drauf.

Die hÃ¤tten dann ungefÃ¤hr so ausgesehen:
                    `),
                },
            ],
        },
        // Planung 2
        {
            isCover: false,
            isTurnedOver: false,
            isClickable: true,
            parts: [
                {
                    type: 'card',
                },
                {
                    type: 'markdown',
                    content: marked.parse(`
Am Ende hÃ¤ttest du alle Codes in der richtigen Reihenfolge in ein Formular eintragen mÃ¼ssen und dann hÃ¤ttest du gesehen
wo ich mich versteckt halte. Vermutlich wÃ¤re ich irgendwo auf deiner StraÃŸe gewesen und hÃ¤tte dort auf dich gewartet. ğŸ˜…

Desweiteren musste ich bei deinem Geschenk etwas umorganisieren. Eigentlich wollte ich dir ein tolles Bild in ein
Holzbrett gravieren. DafÃ¼r war ich dann aber zu ungeschickt und zu zittrig.
                    `),
                },
            ],
        },
        // Planung 3
        {
            isCover: false,
            isTurnedOver: false,
            isClickable: true,
            parts: [
                {
                    type: 'markdown',
                    content: marked.parse(`
Dann hab ich mir gedacht, dass ich doch auch was anderes aus den Brettern machen kÃ¶nnte. Da ist mir eingefallen, dass
ich doch einfach ein paar Dinge ausschneiden und dann auf ein groÃŸes Brett kleben kÃ¶nnte. Das habe ich dann letztendlich
gemacht. Ich habe den Entwicklungsprozess etwas dokumentiert. Auf der nÃ¤chsten Seite findest du ein paar Bilder.
                    `),
                },
            ],
        },
        // Bilder 1
        {
            isCover: false,
            isTurnedOver: false,
            isClickable: true,
            parts: [
                {
                    type: 'image',
                    props: {
                        thumbnailUrl: '/src/assets/images/thumbnails/001.jpg',
                        originalUrl: '/src/assets/images/001.jpg',
                        caption: 'Die ersten Schnitte sind gemacht.',
                    }
                },
                {
                    type: 'image',
                    props: {
                        thumbnailUrl: '/src/assets/images/thumbnails/002.jpg',
                        originalUrl: '/src/assets/images/002.jpg',
                        caption: 'Meine Werkzeuge die ich genutzt habe.',
                    }
                },
                {
                    type: 'image',
                    props: {
                        thumbnailUrl: '/src/assets/images/thumbnails/004.jpg',
                        originalUrl: '/src/assets/images/004.jpg',
                        caption: 'Nicht nur ins Holz habe ich geschnitten.',
                    }
                },
            ],
        },
        // Bilder 2
        {
            isCover: false,
            isTurnedOver: false,
            isClickable: true,
            parts: [
                {
                    type: 'image',
                    props: {
                        thumbnailUrl: '/src/assets/images/thumbnails/005.jpg',
                        originalUrl: '/src/assets/images/005.jpg',
                        caption: 'Hier ein Bild vom ÃœbeltÃ¤ter! ğŸš¨',
                    }
                },
                {
                    type: 'image',
                    props: {
                        thumbnailUrl: '/src/assets/images/thumbnails/006.jpg',
                        originalUrl: '/src/assets/images/006.jpg',
                        caption: 'Hab dann ein Pflaster von Mama bekommen. Das hatte ich zwei Tage getragen.',
                    }
                },
                {
                    type: 'image',
                    props: {
                        thumbnailUrl: '/src/assets/images/thumbnails/008.jpg',
                        originalUrl: '/src/assets/images/008.jpg',
                        caption: 'Hier die fertig ausgeschnittenen Dinos. ğŸ¦•ğŸ¦•',
                    }
                },
            ],
        },
        // Bilder 3
        {
            isCover: false,
            isTurnedOver: false,
            isClickable: true,
            parts: [
                {
                    type: 'image',
                    props: {
                        thumbnailUrl: '/src/assets/images/thumbnails/009.jpg',
                        originalUrl: '/src/assets/images/009.jpg',
                        caption: 'Um die Landschaft etwas schÃ¶ner zu machen, habe ich noch einen Grasstreifen vorbereitet.',
                    }
                },
                {
                    type: 'image',
                    props: {
                        thumbnailUrl: '/src/assets/images/thumbnails/010.jpg',
                        originalUrl: '/src/assets/images/010.jpg',
                        caption: 'Hier ist er dann auch fertig ausgeschnitten.',
                    }
                },
                {
                    type: 'image',
                    props: {
                        thumbnailUrl: '/src/assets/images/thumbnails/011.jpg',
                        originalUrl: '/src/assets/images/011.jpg',
                        caption: 'Sieht doch eigentlich schon niedlich aus.',
                    }
                },
            ],
        },
        // Bilder 4
        {
            isCover: false,
            isTurnedOver: false,
            isClickable: true,
            parts: [
                {
                    type: 'image',
                    props: {
                        thumbnailUrl: '/src/assets/images/thumbnails/012.jpg',
                        originalUrl: '/src/assets/images/012.jpg',
                        caption: 'Etwas mehr Vegetation darf nicht fehlen.',
                    }
                },
                {
                    type: 'image',
                    props: {
                        thumbnailUrl: '/src/assets/images/thumbnails/014.jpg',
                        originalUrl: '/src/assets/images/014.jpg',
                        caption: 'Ich hab noch ein BÃ¤umchen gebaut. Das kommt auch noch mit drauf.',
                    }
                },
                {
                    type: 'image',
                    props: {
                        thumbnailUrl: '/src/assets/images/thumbnails/015.jpg',
                        originalUrl: '/src/assets/images/015.jpg',
                        caption: 'Mein Schreibtisch hat auch etwas unter der Aktion gelitten, aber das ist nicht schlimm. ğŸ˜…',
                    }
                },
            ],
        },
        // Bilder 5
        {
            isCover: false,
            isTurnedOver: false,
            isClickable: true,
            parts: [
                {
                    type: 'image',
                    props: {
                        thumbnailUrl: '/src/assets/images/thumbnails/016.jpg',
                        originalUrl: '/src/assets/images/016.jpg',
                        caption: 'Jetzt noch etwas Farbe da drauf bringen. ğŸ™ˆ',
                    }
                },
                {
                    type: 'image',
                    props: {
                        thumbnailUrl: '/src/assets/images/thumbnails/017.jpg',
                        originalUrl: '/src/assets/images/017.jpg',
                        caption: 'Das Malkasten WeiÃŸ immer so doof sein muss. Musste dreimal drÃ¼ber streichen. ğŸ™„',
                    }
                },
                {
                    type: 'image',
                    props: {
                        thumbnailUrl: '/src/assets/images/thumbnails/018.jpg',
                        originalUrl: '/src/assets/images/018.jpg',
                        caption: 'Nimmt doch Form an.',
                    }
                },
            ],
        },
        // Bilder 6
        {
            isCover: false,
            isTurnedOver: false,
            isClickable: true,
            parts: [
                {
                    type: 'image',
                    props: {
                        thumbnailUrl: '/src/assets/images/thumbnails/019.jpg',
                        originalUrl: '/src/assets/images/019.jpg',
                        caption: 'NatÃ¼rlich werden die anderen Sachen auch noch angemalt.',
                    }
                },
                {
                    type: 'image',
                    props: {
                        thumbnailUrl: '/src/assets/images/thumbnails/020.jpg',
                        originalUrl: '/src/assets/images/020.jpg',
                        caption: 'Der Himmel ist mir nicht ganz so gelungen. Sollte eigentlich bissl heller sein. ğŸ˜…',
                    }
                },
                {
                    type: 'markdown',
                    content: marked.parse(`
Das war eine kurze Tour durch meine vergangenen Abende. Das Endergebnis kannst du dir spÃ¤ter anschauen. ğŸ˜… Ich sags mal
so, sieht aus wie von einem 3-jÃ¤hrigen gebaut, aber es steckt viel SchweiÃŸ, Blut und Liebe drin. ğŸ¥°ğŸ˜˜
                    `),
                },
            ],
        },
        // Schlusswort
        {
            isCover: false,
            isTurnedOver: false,
            isClickable: false,
            parts: [
                {
                    type: 'markdown',
                    content: marked.parse(`
Nun stellst du dir bestimmt die Frage, warum ich diesen Aufwand betrieben habe. Nun, ich wollte dir einfach etwas
basteln. NatÃ¼rlich habe ich auch noch etwas anderes im GepÃ¤ck. ğŸ˜˜ Kannst ja vielleicht mal aus dem Fenster schauen
und gucken, ob ich schon irgendwo rumstehe. ğŸ¤­

Ich wÃ¼nsche dir an dieser Stelle dann mal noch einen schÃ¶nen Abend und noch ein paar schÃ¶ne Stunden an deinem
Geburtstag. ğŸ¥³ğŸ¥°ğŸ˜˜
                    `),
                },
            ],
        },
    ];

    function movePage(page, forceTurnOver = false) {
        if (!pages[page].isClickable && !forceTurnOver) return;

        pages[page].isTurnedOver = !pages[page].isTurnedOver;
    }
</script>

<div class="d-none d-lg-block birthday-card">
    <div class="birthday-card__instruction">
        Klicke auf die Seiten um zu blÃ¤ttern.
    </div>
    {#each pages as page, idx}
        <div class="birthday-card__page birthday-card__page--front"
             class:birthday-card__page--cover={page.isCover}
             class:birthday-card__page--turned-over="{page.isTurnedOver}"
             on:click={_ => movePage(idx)}>
            {#each page.parts as part}
                {#if part.type === 'markdown'}
                    {@html part.content}
                {:else if part.type === 'cake'}
                    <Cake/>
                {:else if part.type === 'card'}
                    <HintCard/>
                {:else if part.type === 'code-form'}
                    <CodeForm formWasValid={_ => movePage(idx, true)}/>
                {:else if part.type === 'image'}
                    <Image {...part.props}/>
                {/if}
            {/each}
        </div>
        <div class="birthday-card__page birthday-card__page--back"
             class:birthday-card__page--turned-over="{page.isTurnedOver}"
             on:click={_ => movePage(idx)}>
        </div>
    {/each}
</div>

<style lang="scss">
  $book-h-ratio: 8.5;
  $book-w-ratio: 5.5;
  $book-size: 77px;

  .birthday-card {
    height: $book-size * $book-h-ratio;
    position: relative;
    transform: perspective(2400px);
    transform-style: preserve-3d;
    width: $book-size * $book-w-ratio * 2;
    pointer-events: none;
  }

  .birthday-card__instruction {
    background: #fff7;
    border-radius: 15px;
    color: #0009;
    font-size: 26px;
    left: 25%;
    padding: 10px 15px;
    position: absolute;
    text-align: center;
    top: 50%;
    transform: translate(-50%, -50%);
    width: 300px;
  }

  .birthday-card__page {
    height: $book-size * $book-h-ratio;
    position: absolute;
    right: 0;
    top: 0;
    transform-origin: 0 50%;
    transition: transform 1s;
    width: $book-size * $book-w-ratio;
    pointer-events: all;

    &.birthday-card__page--cover {
      background: linear-gradient(#afd2dd, #a1d5e5) 50% 50% / 80% 86% no-repeat,
      linear-gradient(#ffffff, #ffffff) 50% 50% / 90% 93% no-repeat,
      linear-gradient(#9bc8d6, #9bc8d6) no-repeat;
      display: flex;
      flex-direction: column;
      padding: 100px 45px 50px;
      text-align: center;

      & > * {
        flex: 1;
      }
    }
  }

  .birthday-card__page--front {
    background: #eeeeee;
    padding: 50px 45px;
  }

  .birthday-card__page--back {
    background: #e8e8e8;
  }

  @for $i from 1 through 30 {
    .birthday-card__page:nth-child(#{$i}) {
      transform: translatez(-.2px * $i) rotatey(0deg);
    }

    .birthday-card__page--turned-over:nth-child(#{$i}) {
      transform: translatez(.2px * $i) rotatey(-180deg);
    }
  }
</style>
